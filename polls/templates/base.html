<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Bar Example</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<!-- Top Bar -->
<header class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
            <!-- Left: Logo + Navigation -->
            <div class="flex items-center space-x-8">
                <div class="text-xl font-bold text-blue-600">
                    SuggestMetrics
                </div>

                <!-- Navigation Links -->
                <nav class="hidden md:flex space-x-6 text-gray-700">
                    <a href="/suggestMetrics" class="hover:text-blue-600 transition">Home</a>
                    <a href="/suggestMetrics/about" class="hover:text-blue-600 transition">About</a>
                    <a href="/suggestMetrics/metricsExplained" class="hover:text-blue-600 transition">Metrics
                        Explained</a>
                </nav>
            </div>

            <!-- Right: Log in Button -->
            <div class="hidden md:block">
                <a href="#" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                    Log in
                </a>
            </div>
        </div>
    </div>
</header>
<body class="bg-gray-100">
<div class="min-h-[calc(100vh-4rem)] flex items-center justify-center">
    <form method="POST" enctype="multipart/form-data"
          class="flex flex-col gap-6 w-[640px] justify-start bg-white rounded-2xl p-10 shadow-2xl"
          id="base_form">
        {% csrf_token %}
        <fieldset>
            <label for="task">Choose a task:</label>
            <select id="task" name="task"
                    class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none w-60"
                    required>
                <option value="classification">Classification</option>
                <option value="regression">Model Relation</option>
                {#            <option value="clustering">Clustering</option>#}
            </select>
        </fieldset>
        <fieldset>
            <label for="userData"
                   class="inline-block bg-blue-600 text-white text-lg py-2 px-6 rounded-xl shadow-md cursor-pointer hover:bg-blue-700 transform hover:scale-105 transition-all duration-300 ease-in-out">
                Upload CSV
            </label>
            <input type="file" id="userData" name="user_data" accept="text/csv" required class="hidden"/>
            <div id="fileName" class="mt-2 text-gray-600 text-sm">No file selected</div>
        </fieldset>
        <div id="columnSelector" style="display: none;"></div>
        <button type="submit"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition">
            Upload
        </button>
    </form>
</div>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
    document.getElementById("base_form").addEventListener('change', (event) => {
        const eventType = event.target.id
        if (eventType !== "task" && eventType !== "userData") return;

        const columnSelector = document.getElementById('columnSelector');

        const file = document.getElementById('userData').files[0];
        if (!file) return;

        const task = document.getElementById('task').value;

        document.getElementById('fileName').textContent = `Selected file: ${file.name}`;

        Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: function (results) {
                const data = results.data;
                const headers = results.meta.fields;

                columnSelector.innerHTML = '';
                if (task === 'regression') {
                    generateDropdown(headers, 'target', columnSelector, 'What are you trying to predict? (target variable)');
                    generateCheckboxes(headers, columnSelector, 'What variables are you using to predict your target?');
                    generateQuestion("isPolynomial", columnSelector, "Do you expect your data to be curved or shaped in a non-linear way? Would you like to model polynomial fit?");

                    document.getElementById('isPolynomial_yes').addEventListener('change', () => {
                        options = ['2', '3', 'more than 3']
                        generateDropdown(options, 'degreeOfPolynomial', columnSelector, 'What do you expect to be your highest degree polynomial term in your model?');
                    });
                    document.getElementById('isPolynomial_no').addEventListener('change', () => {
                        const oldSelect = document.getElementById('degreeOfPolynomial');
                        if (oldSelect) {
                            columnSelector.removeChild(oldSelect.parentElement);
                        }
                    });
                } else if (task === 'classification') {
                    generateDropdown(headers, 'target', columnSelector, 'Choose the column of classes:');

                    document.getElementById('target').addEventListener('change', function (e) {
                        const selectedColumn = e.target.value;
                        const values = data.map(row => row[selectedColumn]);
                        const uniqueValues = [...new Set(values)];
                        generateDropdown(uniqueValues, 'positiveClass', columnSelector, 'Choose the positive class:');
                    });

                    generateQuestion("isCostSensitive", columnSelector, "Is misclassification costly or otherwise problematic?");
                    generateQuestion("isSpecific", columnSelector, "Are you concerned about the performance of specific classes?");
                } else if (task === 'clustering') {
                    generateCheckboxes(headers, columnSelector, 'Choose the feature columns:');
                }
            }
        });

        columnSelector.style.display = 'block';
    });

    function generateCheckboxes(items, container, text) {
        const label = document.createElement('label');
        label.htmlFor = 'features';
        label.textContent = text;
        label.className = "block text-gray-700 font-medium mb-2";
        container.appendChild(label);

        const featureGroup = document.createElement('div');
        featureGroup.id = 'features';
        featureGroup.name = 'features';
        featureGroup.className = "flex flex-wrap gap-4";

        items.forEach((header, index) => {
            const cleanHeader = header.trim();

            const wrapper = document.createElement('div');
            wrapper.className = "flex items-center gap-2";

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = 'features';
            checkbox.value = cleanHeader;
            checkbox.id = `features_${index}`;
            checkbox.className = "h-4 w-4 text-blue-600 border-gray-300 rounded";

            const label = document.createElement('label');
            label.htmlFor = `features_${index}`;
            label.className = "text-gray-700";
            label.appendChild(document.createTextNode(cleanHeader));

            wrapper.appendChild(checkbox);
            wrapper.appendChild(label);
            featureGroup.appendChild(wrapper);
        });

        container.appendChild(featureGroup);
    }

    function generateDropdown(items, id, container, text) {
        const oldSelect = document.getElementById(id);
        if (oldSelect) {
            container.removeChild(oldSelect.parentElement);
        }

        const wrapper = document.createElement('div');
        wrapper.className = "flex flex-col gap-2";

        const label = document.createElement('label');
        label.htmlFor = id;
        label.textContent = text;
        label.className = "text-gray-700 font-medium";
        wrapper.appendChild(label);

        const select = document.createElement('select');
        select.name = id;
        select.id = id;
        select.required = true;
        select.className = "border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none w-60";
        items.forEach(item => {
            const option = new Option(item, item);
            select.add(option);
        });
        wrapper.appendChild(select);

        container.appendChild(wrapper);
    }

    function generateQuestion(id, container, text) {
        const wrapper = document.createElement('div');
        wrapper.className = "flex flex-col gap-2";

        const groupLabel = document.createElement('label');
        groupLabel.textContent = text;
        groupLabel.className = "text-gray-700 font-medium";
        wrapper.appendChild(groupLabel);

        const optionsWrapper = document.createElement('div');
        optionsWrapper.className = "flex gap-6 items-center";

        const yesId = `${id}_yes`;
        const yesRadio = document.createElement('input');
        yesRadio.type = 'radio';
        yesRadio.name = id;
        yesRadio.value = 'true';
        yesRadio.id = yesId;
        yesRadio.className = "h-4 w-4 text-blue-600 border-gray-300";

        const yesLabel = document.createElement('label');
        yesLabel.htmlFor = yesId;
        yesLabel.className = "flex items-center gap-2 text-gray-700";
        yesLabel.appendChild(yesRadio);
        yesLabel.appendChild(document.createTextNode('Yes'));

        const noId = `${id}_no`;
        const noRadio = document.createElement('input');
        noRadio.type = 'radio';
        noRadio.name = id;
        noRadio.value = 'false';
        noRadio.id = noId;
        noRadio.className = "h-4 w-4 text-blue-600 border-gray-300";

        const noLabel = document.createElement('label');
        noLabel.htmlFor = noId;
        noLabel.className = "flex items-center gap-2 text-gray-700";
        noLabel.appendChild(noRadio);
        noLabel.appendChild(document.createTextNode('No'));

        optionsWrapper.appendChild(yesLabel);
        optionsWrapper.appendChild(noLabel);
        wrapper.appendChild(optionsWrapper);

        container.appendChild(wrapper);
    }
</script>
</html>
