<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Bar Example</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<!-- Top Bar -->
<header class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
            <!-- Left: Logo + Navigation -->
            <div class="flex items-center space-x-8">
                <div class="text-xl font-bold text-blue-600">
                    SuggestMetrics
                </div>

                <!-- Navigation Links -->
                <nav class="hidden md:flex space-x-6 text-gray-700">
                    <a href="/suggestMetrics" class="hover:text-blue-600 transition">Home</a>
                    <a href="/suggestMetrics/about" class="hover:text-blue-600 transition">About</a>
                    <a href="/suggestMetrics/metricsExplained" class="hover:text-blue-600 transition">Metrics
                        Explained</a>
                </nav>
            </div>

            <!-- Right: Log in Button -->
            <div class="hidden md:block">
                <a href="#" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                    Log in
                </a>
            </div>
        </div>
    </div>
</header>
<body class="bg-gray-100">
<form method="POST" enctype="multipart/form-data"
      class="flex flex-col gap-4 w-[600px] justify-start bg-gray-300 rounded-xl"
      id="base_form"
>
    {% csrf_token %}
    <fieldset>
        <label for="task">Choose a task:</label>
        <select id="task" name="task" required>
            <option value="classification">Classification</option>
            <option value="regression">Regression</option>
            <option value="clustering">Clustering</option>
        </select>
    </fieldset>
    <fieldset>
        <label for="user_data">Choose a csv file:</label>
        <input type="file" accept="text/csv" id="userData" name="user_data" required/>
    </fieldset>
    <div id="columnSelector" style="display: none;"></div>
    <button type="submit">Upload</button>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
    document.getElementById("base_form").addEventListener('change', (event) => {
        const eventType = event.target.id
        if (eventType !== "task" && eventType !== "userData") return;

        const columnSelector = document.getElementById('columnSelector');

        const file = document.getElementById('userData').files[0];
        if (!file) return;

        const task = document.getElementById('task').value;

        Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: function (results) {
                const data = results.data;
                const headers = results.meta.fields;

                columnSelector.innerHTML = '';
                if (task === 'regression') {
                    generateCheckboxes(headers, columnSelector, 'Choose the feature columns:');
                    generateDropdown(headers, 'target', columnSelector, 'Choose the column to predict:');
                } else if (task === 'classification') {
                    generateDropdown(headers, 'target', columnSelector, 'Choose the column of classes:');

                    document.getElementById('target').addEventListener('change', function (e) {
                        const selectedColumn = e.target.value;
                        const values = data.map(row => row[selectedColumn]);
                        const uniqueValues = [...new Set(values)];
                        generateDropdown(uniqueValues, 'positiveClass', columnSelector, 'Choose the positive class:');
                    });

                    generateQuestion("isCostSensitive", columnSelector, "Is misclassification costly or otherwise problematic?");
                    generateQuestion("isSpecific", columnSelector, "Are you concerned about the performance of specific classes?");
                } else if (task === 'clustering') {
                    generateCheckboxes(headers, columnSelector, 'Choose the feature columns:');
                }
            }
        });

        columnSelector.style.display = 'block';
    });

    function generateCheckboxes(items, container, text) {
        const label = document.createElement('label');
        label.htmlFor = 'features';
        label.textContent = text;
        container.appendChild(label);

        const featureGroup = document.createElement('div');
        featureGroup.id = 'features';
        featureGroup.name = 'features';

        items.forEach((header, index) => {
            const cleanHeader = header.trim();

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = 'features';
            checkbox.value = cleanHeader;
            checkbox.id = `features_${index}`;

            const label = document.createElement('label');
            label.htmlFor = `features_${index}`;
            label.style.marginRight = '12px';
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(` ${cleanHeader}`));

            featureGroup.appendChild(label);
        });

        container.appendChild(featureGroup);
    }

    function generateDropdown(items, id, container, text) {
        const oldSelect = document.getElementById(id);
        if (oldSelect) {
            container.removeChild(oldSelect.parentElement);
        }

        const wrapper = document.createElement('div');

        const label = document.createElement('label');
        label.htmlFor = id;
        label.textContent = text;
        wrapper.appendChild(label);

        const select = document.createElement('select');
        select.name = id;
        select.id = id;
        select.required = true;
        items.forEach(item => {
            const option = new Option(item, item);
            select.add(option);
        });
        wrapper.appendChild(select);

        container.appendChild(wrapper);
    }

    function generateQuestion(id, container, text) {
        const wrapper = document.createElement('div');

        const groupLabel = document.createElement('label');
        groupLabel.textContent = text;
        wrapper.appendChild(groupLabel);

        const yesId = `${id}_yes`;
        const yesRadio = document.createElement('input');
        yesRadio.type = 'radio';
        yesRadio.name = id;
        yesRadio.value = 'true';
        yesRadio.id = yesId;

        const yesLabel = document.createElement('label');
        yesLabel.htmlFor = yesId;
        yesLabel.appendChild(yesRadio);
        yesLabel.appendChild(document.createTextNode(' Yes'));

        const noId = `${id}_no`;
        const noRadio = document.createElement('input');
        noRadio.type = 'radio';
        noRadio.name = id;
        noRadio.value = 'false';
        noRadio.id = noId;

        const noLabel = document.createElement('label');
        noLabel.htmlFor = noId;
        noLabel.appendChild(noRadio);
        noLabel.appendChild(document.createTextNode(' No'));

        wrapper.appendChild(yesLabel);
        wrapper.appendChild(noLabel);

        container.appendChild(wrapper);
    }
</script>
</body>
</html>
